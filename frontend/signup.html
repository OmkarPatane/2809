<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ScanMyMeal</title>
    <link rel="stylesheet" href="signupStyle.css" />
  </head>
  <body>
    <nav>
      <div><img src="./scanmymeallogo2.png" alt="" /></div>
      <h2>Welcome To Scan My Meal</h2>
    </nav>
    <div id="main">
      <div class="message">
        <h1>Welcome Back!</h1>
        <p>
          To keep connected with us please login<br />with your personal info
        </p>
        <button class="ghost" id="signIn">Sign In</button>
      </div>
      <div class="container" id="container">
        <div class="form-container sign-up-container">
          <form id="signupForm">
            <h1>Create Account</h1>
            <input type="text" id="name" placeholder="Name" required />
            <input type="email" id="email" placeholder="Email" required />
            <input type="password" id="password" placeholder="Password" required />
            <button type="submit">Sign Up</button>
          </form>
        </div>
      </div>
    </div>

    <script>
      document.getElementById("signupForm").addEventListener("submit", function(event) {
        event.preventDefault(); // Prevent default form submission

        const name = document.getElementById("name").value;
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        // First, check if the email is already taken by sending a GET request
        fetch(`YOUR_API_ENDPOINT_HERE/check-email?email=${email}`, {
          method: "GET",
        })
          .then(response => response.json())
          .then(data => {
            if (data.exists) {
              alert("Email already registered. Please try logging in.");
            } else {
              // If email is not already taken, proceed with signup
              const userData = {
                name: name,
                email: email,
                password: password
              };

              // Send the POST request to register the new user
              fetch("YOUR_API_ENDPOINT_HERE/signup", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json"
                },
                body: JSON.stringify(userData)
              })
                .then(response => response.json())
                .then(data => {
                  if (data.success) {
                    alert("Account created successfully!");
                    // Redirect to login or other page
                  } else {
                    alert("Signup failed: " + data.message);
                  }
                })
                .catch(error => {
                  console.error("Error:", error);
                  alert("An error occurred. Please try again.");
                });
            }
          })
          .catch(error => {
            console.error("Error checking email:", error);
            alert("An error occurred while checking the email.");
          });
      });
    </script>
  </body>
</html>
